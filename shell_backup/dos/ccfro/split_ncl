#!/bin/bash
fermi=$(awk 'NR==6{print $4}' DOSCAR)
nedos=$(awk 'NR==6{print $3}' DOSCAR)
natom=$(awk 'NR==1{print $1}' DOSCAR)

for i in `seq 0 1 $natom`
do
	let "a=6+($i*($nedos+1))"
	let "b=6+$nedos+$i*($nedos+1)"
echo  $i $a $b
sed -n "$a,$b p" DOSCAR >0DOS$i		# 截取指定行
sed  '1d' 0DOS$i >1DOS$i 		# delete the first line
done
awk -v f="$fermi" '{print $1-f}' 1DOS0 >e


#read -p "lm-decomposed or not:" answer
for i in `seq 0 1 $natom`
do
awk '{$1="";print $0}' 1DOS$i >2DOS$i	# 删除首列

paste e  2DOS$i > nDOS$i

done
rm 0DOS* 1DOS*  2DOS* ntDOS*


# for the first two atoms
#awk 'NR==FNR {s1[$1]=$2;s2[$1]=$3;py1[$1]=$4;py2[$1]=$5;pz1[$1]=$6;pz2[$1]=$7;px1[$1]=$8;px2[$1]=$9;dzy1[$1]=$10;dxy2[$1]=$11;dyz1[$1]=$12;dyz2[$1]=$13;dz1[$1]=$14;dz2[$1]=$15;dxz1[$1]=$16;dxz2[$1]=$17;dr1[$1]=$18;dr2[$1]=$19} NR>FNR {s1[$1]+=$2;s2[$1]+=$3;py1[$1]+=$4;py2[$1]+=$5;pz1[$1]+=$6;pz2[$1]+=$7;px1[$1]+=$8;px2[$1]+=$9;dxy1[$1]+=$10;dxy2[$1]+=$11;dyz1[$1]+=$12;dyz2[$1]+=$13;dz1[$1]+=$14;dz2[$1]+=$15;dxz1[$1]+=$16;dxz2[$1]+=$17;dr1[$1]+=$18;dr2[$1]+=$19; print $1,"s1",s1[$1],"s2",s2[$1],"py1",py1[$1],"py2",py2[$1],"pz1",pz1[$1],"pz2",pz2[$1],"px1",px1[$1],"px2",px2[$1],"dxy1",dxy1[$1],"dxy2",dxy2[$1],"dyz1",dyz1[$1],"dyz2",dyz2[$1],"dz1",dz1[$1],"dz2",dz2[$1],"dxz1",dxz1[$1],"dxz2",dxz2[$1],"dr1",dr1[$1],"dr2",dr2[$1]}' nDOS1 nDOS2 | tail -301> 1-2.dat
awk 'NR==FNR {s1[$1]=$2;s2[$1]=$3;py1[$1]=$4;py2[$1]=$5;pz1[$1]=$6;pz2[$1]=$7;px1[$1]=$8;px2[$1]=$9;dzy1[$1]=$10;dxy2[$1]=$11;dyz1[$1]=$12;dyz2[$1]=$13;dz1[$1]=$14;dz2[$1]=$15;dxz1[$1]=$16;dxz2[$1]=$17;dr1[$1]=$18;dr2[$1]=$19} NR>FNR {s1[$1]+=$2;s2[$1]+=$3;py1[$1]+=$4;py2[$1]+=$5;pz1[$1]+=$6;pz2[$1]+=$7;px1[$1]+=$8;px2[$1]+=$9;dxy1[$1]+=$10;dxy2[$1]+=$11;dyz1[$1]+=$12;dyz2[$1]+=$13;dz1[$1]+=$14;dz2[$1]+=$15;dxz1[$1]+=$16;dxz2[$1]+=$17;dr1[$1]+=$18;dr2[$1]+=$19; print $1,s1[$1],s2[$1],py1[$1],py2[$1],pz1[$1],pz2[$1],px1[$1],px2[$1],dxy1[$1],dxy2[$1],dyz1[$1],dyz2[$1],z1[$1],z2[$1],dxz1[$1],dxz2[$1],r1[$1],dr2[$1]}' nDOS1 nDOS2 | tail -301> 1-2.dat

# from 3 to 8
awk 'NR==FNR {s1[$1]=$2;s2[$1]=$3;py1[$1]=$4;py2[$1]=$5;pz1[$1]=$6;pz2[$1]=$7;px1[$1]=$8;px2[$1]=$9;dzy1[$1]=$10;dxy2[$1]=$11;dyz1[$1]=$12;dyz2[$1]=$13;dz1[$1]=$14;dz2[$1]=$15;dxz1[$1]=$16;dxz2[$1]=$17;dr1[$1]=$18;dr2[$1]=$19} NR>FNR {s1[$1]+=$2;s2[$1]+=$3;py1[$1]+=$4;py2[$1]+=$5;pz1[$1]+=$6;pz2[$1]+=$7;px1[$1]+=$8;px2[$1]+=$9;dxy1[$1]+=$10;dxy2[$1]+=$11;dyz1[$1]+=$12;dyz2[$1]+=$13;dz1[$1]+=$14;dz2[$1]+=$15;dxz1[$1]+=$16;dxz2[$1]+=$17;dr1[$1]+=$18;dr2[$1]+=$19; print $1,s1[$1],s2[$1],py1[$1],py2[$1],pz1[$1],pz2[$1],px1[$1],px2[$1],dxy1[$1],dxy2[$1],dyz1[$1],dyz2[$1],dz1[$1],dz2[$1],dxz1[$1],dxz2[$1],dr1[$1],dr2[$1]}' nDOS3 nDOS4 nDOS5 nDOS6 nDOS7 nDOS8 |tail -301> 3-8.dat

# from 9 to 12
awk 'NR==FNR {s1[$1]=$2;s2[$1]=$3;py1[$1]=$4;py2[$1]=$5;pz1[$1]=$6;pz2[$1]=$7;px1[$1]=$8;px2[$1]=$9;dzy1[$1]=$10;dxy2[$1]=$11;dyz1[$1]=$12;dyz2[$1]=$13;dz1[$1]=$14;dz2[$1]=$15;dxz1[$1]=$16;dxz2[$1]=$17;dr1[$1]=$18;dr2[$1]=$19} NR>FNR {s1[$1]+=$2;s2[$1]+=$3;py1[$1]+=$4;py2[$1]+=$5;pz1[$1]+=$6;pz2[$1]+=$7;px1[$1]+=$8;px2[$1]+=$9;dxy1[$1]+=$10;dxy2[$1]+=$11;dyz1[$1]+=$12;dyz2[$1]+=$13;dz1[$1]+=$14;dz2[$1]+=$15;dxz1[$1]+=$16;dxz2[$1]+=$17;dr1[$1]+=$18;dr2[$1]+=$19; print $1,s1[$1],s2[$1],py1[$1],py2[$1],pz1[$1],pz2[$1],px1[$1],px2[$1],dxy1[$1],dxy2[$1],dyz1[$1],dyz2[$1],dz1[$1],dz2[$1],dxz1[$1],dxz2[$1],dr1[$1],dr2[$1]}' nDOS9 nDOS10 nDOS11 nDOS12 |tail -301> 9-12.dat

# from 13 to 16
awk 'NR==FNR {s1[$1]=$2;s2[$1]=$3;py1[$1]=$4;py2[$1]=$5;pz1[$1]=$6;pz2[$1]=$7;px1[$1]=$8;px2[$1]=$9;dzy1[$1]=$10;dxy2[$1]=$11;dyz1[$1]=$12;dyz2[$1]=$13;dz1[$1]=$14;dz2[$1]=$15;dxz1[$1]=$16;dxz2[$1]=$17;dr1[$1]=$18;dr2[$1]=$19} NR>FNR {s1[$1]+=$2;s2[$1]+=$3;py1[$1]+=$4;py2[$1]+=$5;pz1[$1]+=$6;pz2[$1]+=$7;px1[$1]+=$8;px2[$1]+=$9;dxy1[$1]+=$10;dxy2[$1]+=$11;dyz1[$1]+=$12;dyz2[$1]+=$13;dz1[$1]+=$14;dz2[$1]+=$15;dxz1[$1]+=$16;dxz2[$1]+=$17;dr1[$1]+=$18;dr2[$1]+=$19; print $1,s1[$1],s2[$1],py1[$1],py2[$1],pz1[$1],pz2[$1],px1[$1],px2[$1],dxy1[$1],dxy2[$1],dyz1[$1],dyz2[$1],dz1[$1],dz2[$1],dxz1[$1],dxz2[$1],dr1[$1],dr2[$1]}' nDOS13 nDOS14 nDOS15 nDOS16 |tail -301> 13-16.dat

# from 17 to 40
awk 'NR==FNR {s1[$1]=$2;s2[$1]=$3;py1[$1]=$4;py2[$1]=$5;pz1[$1]=$6;pz2[$1]=$7;px1[$1]=$8;px2[$1]=$9;dzy1[$1]=$10;dxy2[$1]=$11;dyz1[$1]=$12;dyz2[$1]=$13;dz1[$1]=$14;dz2[$1]=$15;dxz1[$1]=$16;dxz2[$1]=$17;dr1[$1]=$18;dr2[$1]=$19} NR>FNR {s1[$1]+=$2;s2[$1]+=$3;py1[$1]+=$4;py2[$1]+=$5;pz1[$1]+=$6;pz2[$1]+=$7;px1[$1]+=$8;px2[$1]+=$9;dxy1[$1]+=$10;dxy2[$1]+=$11;dyz1[$1]+=$12;dyz2[$1]+=$13;dz1[$1]+=$14;dz2[$1]+=$15;dxz1[$1]+=$16;dxz2[$1]+=$17;dr1[$1]+=$18;dr2[$1]+=$19; print $1,s1[$1],s2[$1],py1[$1],py2[$1],pz1[$1],pz2[$1],px1[$1],px2[$1],dxy1[$1],dxy2[$1],dyz1[$1],dyz2[$1],dz1[$1],dz2[$1],dxz1[$1],dxz2[$1],dr1[$1],dr2[$1]}' nDOS17 nDOS18 nDOS19 nDOS20 nDOS21 nDOS22 nDOS23 nDOS24 nDOS25 nDOS26 nDOS27 nDOS28 nDOS29 nDOS30 nDOS31 nDOS32 nDOS33 nDOS34 nDOS35 nDOS36 nDOS37 nDOS38 nDOS39 nDOS40 |tail -301>17-40.dat
